<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ប្រព័ន្ធស្កេនមុខឌីជីថល — V4</title>
    <link rel="icon" href="https://img.freepik.com/premium-vector/face-scan-icon_933463-79729.jpg" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
</head>
<body data-theme="dark" class="bg-slate-900 text-slate-200">
    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-card text-center">
            <img src="https://i.postimg.cc/FHBn0Fdf/di3-copy.png" alt="Logo" class="w-24 h-24 rounded-full mx-auto mb-4 shadow-lg" />
            <h1 id="login-title" class="text-2xl font-bold text-white khmer-title mb-2">ឩស្សាហកម្មឌីជីថល</h1>
            <p id="login-subtitle" class="text-slate-400 mb-6">សូមជ្រើសរើសឈ្មោះរបស់អ្នក</p>

            <div id="admin-selection-area">
                <div class="w-16 h-16 border-4 border-slate-500 border-t-indigo-500 rounded-full animate-spin mx-auto mb-4" id="admin-list-loader"></div>
                <select id="admin-select" class="hidden filter-select w-full text-base mb-4 py-3 px-4" style="background-position: right 1rem center">
                    <option value="">-- Select Your Name --</option>
                </select>
                <button id="proceed-to-scan-btn" class="hidden w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold hover:bg-indigo-700 transition shadow-lg">បន្តទៅការស្កេន</button>
            </div>

            <div id="admin-scan-area" class="hidden flex flex-col items-center space-y-4">
                <div id="admin-video-wrapper" class="video-container w-[90%] mx-auto aspect-square">
                    <video id="admin-video" autoplay muted playsinline></video>
                </div>
                <canvas id="admin-canvas" class="hidden"></canvas>
                <p id="admin-scan-status" class="text-center text-sm h-10 font-semibold text-slate-400"></p>

                <div class="flex flex-col w-full space-y-3">
                    <button id="admin-manual-scan-btn" class="w-full bg-slate-600 text-white py-3 rounded-xl font-semibold hover:bg-slate-700 transition">
                        <i class="fas fa-camera mr-2"></i> ស្កេនដោយខ្លួនឯង
                    </button>
                    <button id="admin-back-btn" class="w-full text-slate-400 py-2 rounded-xl font-semibold hover:text-white transition">
                        <i class="fas fa-arrow-left mr-2"></i> ត្រលប់​ក្រោយ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app-wrapper" class="hidden">
        <div class="relative min-h-screen md:flex">
            <div id="sidebar-backdrop" class="hidden md:hidden fixed inset-0 bg-black/50 z-30"></div>

            <!-- SIDEBAR -->
            <aside id="sidebar" class="fixed top-0 left-0 w-72 h-full bg-slate-800/90 backdrop-blur-lg z-40 transform -translate-x-full md:translate-x-0 flex flex-col">
                <!-- Logo/Header -->
                <div class="text-center py-5 mb-2 px-4 border-b border-slate-700/40">
                    <div id="sidebar-logo-wrapper" class="flex items-center gap-3 justify-start px-2">
                        <img id="sidebar-logo" src="https://i.postimg.cc/FHBn0Fdf/di3-copy.png" alt="Logo" class="w-14 h-14 rounded-full shadow-md cursor-pointer transition-all" style="object-fit: cover" />
                        <div class="overflow-hidden">
                            <h2 id="sidebar-logo-text" class="text-lg font-bold text-white khmer-title nav-text">ឧស្សាហកម្មឌីជីថល</h2>
                            <p id="sidebar-sub" class="text-slate-400 text-sm nav-text">Face Scan Manager</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <nav class="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                    <ul class="space-y-2">
                        <li>
                            <a href="#" id="nav-scan" class="nav-link active flex items-center gap-3 px-4 py-3 rounded-lg text-slate-300 hover:bg-indigo-500 hover:text-white">
                                <i class="fas fa-camera-retro fa-fw w-5 text-center"></i>
                                <span class="font-semibold nav-text">ថតរូប</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-list" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-slate-300 hover:bg-indigo-500 hover:text-white">
                                <i class="fas fa-users fa-fw w-5 text-center"></i>
                                <span class="font-semibold nav-text">ទិន្នន័យរូបភាពនិស្សិត</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-records" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-slate-300 hover:bg-indigo-500 hover:text-white">
                                <i class="fas fa-database fa-fw w-5 text-center"></i>
                                <span class="font-semibold nav-text">រូបភាពបានរក្សាទុក</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-storage" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-slate-300 hover:bg-indigo-500 hover:text-white">
                                <i class="fas fa-link fa-fw w-5 text-center"></i>
                                <span class="font-semibold nav-text">Storage Links</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-profile" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-slate-300 hover:bg-indigo-500 hover:text-white">
                                <i class="fas fa-user-circle fa-fw w-5 text-center"></i>
                                <span class="font-semibold nav-text">Profile</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-admin" class="nav-link hidden flex items-center gap-3 px-4 py-3 rounded-lg text-slate-300 hover:bg-indigo-500 hover:text-white">
                                <i class="fas fa-shield-halved fa-fw w-5 text-center"></i>
                                <span class="font-semibold nav-text">Admin Panel</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-analytics" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-slate-300 hover:bg-indigo-500 hover:text-white">
                                <i class="fas fa-chart-line fa-fw w-5 text-center"></i>
                                <span class="font-semibold nav-text">Analytics</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Footer (User & Logout) -->
                <div class="p-4 border-t border-slate-700/40 space-y-4">
                    <!-- Clickable Profile Section -->
                    <div id="admin-profile-compact" class="p-2 rounded-lg hover:bg-slate-700/50 cursor-pointer hidden">
                        <div class="flex items-center gap-3">
                            <img id="admin-profile-img-sidebar" class="w-10 h-10 rounded-full flex-shrink-0 transition-all" src="" alt="Admin" crossorigin="anonymous" />
                            <div class="overflow-hidden">
                                <p id="admin-name-sidebar" class="font-semibold text-white nav-text">ឈ្មោះគណនី</p>
                                <p id="admin-role-sidebar" class="text-sm text-slate-300 nav-text">Role</p>
                            </div>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-2 text-center text-sm">
                        <div class="p-2 bg-slate-800/40 rounded">
                            <div id="stat-total" class="font-bold">-</div>
                            <div class="text-xs text-slate-400 nav-text">ទិន្នន័យ</div>
                        </div>
                        <div class="p-2 bg-slate-800/40 rounded">
                            <div id="stat-mycount" class="font-bold">-</div>
                            <div class="text-xs text-slate-400 nav-text">រូបខ្ញុំ</div>
                        </div>
                        <div class="p-2 bg-slate-800/40 rounded">
                            <div id="stat-others" class="font-bold">-</div>
                            <div class="text-xs text-slate-400 nav-text">ផ្សេងៗ</div>
                        </div>
                    </div>

                    <!-- Bottom Actions -->
                    <div class="flex items-center justify-between gap-2">
                        <a href="#" id="logout-btn" class="flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-slate-300 bg-red-600/50 hover:bg-red-600">
                            <i class="fas fa-sign-out-alt fa-fw"></i>
                            <span class="font-medium text-sm nav-text">Logout</span>
                        </a>
                        <a href="#" id="nav-settings-btn" class="hidden h-10 w-10 flex-shrink-0 flex items-center justify-center rounded-lg text-slate-300 bg-slate-700/50 hover:bg-slate-600" title="Settings">
                            <i class="fas fa-cog fa-fw"></i>
                        </a>
                    </div>
                </div>
            </aside>

            <!-- CONTENT -->
            <div id="content-wrapper" class="flex flex-col flex-1 md:ml-72">
                <header class="w-full h-16 bg-slate-800/50 backdrop-blur-lg flex-shrink-0 flex items-center px-4 sticky top-0 z-20">
                    <!-- Mobile Menu Button -->
                    <button id="menu-btn" class="text-white mr-4 md:hidden">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <!-- Desktop Sidebar Toggle Button -->
                    <button id="sidebar-toggle-btn" class="text-white mr-4 hidden md:block">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    
                    <h1 class="text-xl font-bold text-white khmer-title">គ្រប់គ្រងទិន្នន័យរូបភាព</h1>
                   
                    <div class="ml-auto flex items-center gap-3">
                        <div class="hidden md:flex items-center gap-2 bg-slate-700/30 px-3 py-1 rounded-full">
                            <span class="text-sm text-slate-300">System Status:</span>
                            <span id="system-status" class="flex items-center gap-1">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                <span class="text-sm text-green-400">Online</span>
                            </span>
                        </div>
                        <img id="admin-profile-img-header" class="w-10 h-10 rounded-full hidden cursor-pointer" src="" alt="Admin" crossorigin="anonymous" />
                    </div>
                </header>

                <main class="w-full flex-1 p-4 md:p-8">
                    <!-- PAGE: SCAN -->
                    <div id="page-scan">
                        <div class="main-content rounded-2xl p-6">
                            <div class="container w-full max-w-md mx-auto relative">
                                <button id="back-btn" class="hidden absolute -top-2 -left-2 w-10 h-10 bg-slate-700/50 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-slate-600/50 transition z-20" title="Back to Selection">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <h1 class="text-center text-2xl mb-2 text-white khmer-title">ប្រព័ន្ធស្កេនមុខឌីជីថល</h1>
                                <p id="subtitle" class="text-center text-slate-400 mb-6">សូមជ្រើសរើសអត្តលេខរបស់អ្នក</p>

                                <div id="selection-area" class="mb-5">
                                    <div class="flex items-center gap-2 mb-4">
                                        <input type="text" id="student-search-input" placeholder="ស្វែងរកអត្តលេខ ឬឈ្មោះ..." class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                        <button id="voice-search-btn" class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition">
                                            <i class="fas fa-microphone"></i>
                                        </button>
                                    </div>
                                    <div id="scan-options" class="flex gap-2 mb-4">
                                        <button id="batch-scan-btn" class="flex-1 bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
                                            <i class="fas fa-layer-group mr-2"></i> Batch Scan
                                        </button>
                                        <button id="qr-scan-btn" class="flex-1 bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition">
                                            <i class="fas fa-qrcode mr-2"></i> QR Scan
                                        </button>
                                    </div>
                                    <ul id="student-list" class="space-y-1">
                                        <li class="text-center text-slate-400 p-4">Loading students...</li>
                                    </ul>
                                </div>

                                <div id="camera-section" class="hidden flex flex-col items-center space-y-4">
                                    <div id="video-wrapper" class="video-container w-[90%] mx-auto aspect-square">
                                        <video id="video" autoplay muted playsinline></video>
                                        <div class="scanner-line"></div>
                                    </div>
                                    <div class="flex items-center justify-center gap-4">
                                        <button id="switch-camera-btn" class="w-14 h-14 bg-slate-700/50 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-slate-600/50 transition" title="Switch Camera">
                                            <i class="fas fa-sync-alt fa-lg"></i>
                                        </button>
                                        <button id="manual-capture-btn" class="w-20 h-20 bg-indigo-600 rounded-full flex items-center justify-center text-white hover:bg-indigo-700 transition shadow-lg" title="Capture Photo">
                                            <i class="fas fa-camera fa-2x"></i>
                                        </button>
                                    </div>
                                    <canvas id="capture-canvas" class="hidden"></canvas>
                                    <img id="photo-preview" class="hidden w-[90%] mx-auto aspect-square rounded-full border-4 border-green-400 object-cover shadow-lg" />
                                    <p id="face-status" class="text-center text-sm h-5 font-semibold text-slate-400"></p>
                                    <div class="flex flex-col w-full space-y-3">
                                        <button id="upload-btn" class="hidden w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 rounded-xl font-semibold hover:opacity-90 transition shadow-lg">បញ្ជូនរូបភាព</button>
                                        <button id="retake-btn" class="hidden w-full bg-slate-600 text-white py-3 rounded-xl font-semibold hover:bg-slate-700 transition">ថតម្តងទៀត</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PAGE: LIST -->
                    <div id="page-list" class="hidden main-content rounded-2xl p-6 h-full flex flex-col">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                            <h1 class="text-2xl text-white khmer-title">ទិន្នន័យរូបភាពនិស្សិត</h1>
                            <div class="flex gap-4 w-full md:w-auto">
                                <input type="text" id="list-search-input" placeholder="ស្វែងរកអត្តលេខឬឈ្មោះ..." class="w-full bg-slate-700 border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                <select id="list-class-filter" class="filter-select w-full md:w-auto"></select>
                                <button id="export-list-btn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-download mr-2"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 text-left">
                            <div class="bg-slate-700/50 p-4 rounded-lg flex items-center gap-4">
                                <i class="fas fa-users fa-2x text-slate-400"></i>
                                <div>
                                    <p class="text-slate-400">ចំនួននិស្សិតសរុប</p>
                                    <p id="list-total-count" class="text-2xl font-bold text-white">-</p>
                                </div>
                            </div>
                            <div class="bg-green-800/30 p-4 rounded-lg flex items-center gap-4">
                                <i class="fas fa-user-check fa-2x text-green-400"></i>
                                <div>
                                    <p class="text-green-400">និស្សិតមានរូបភាព</p>
                                    <p id="list-completed-count" class="text-2xl font-bold text-green-400">-</p>
                                </div>
                            </div>
                            <div class="bg-red-800/30 p-4 rounded-lg flex items-center gap-4">
                                <i class="fas fa-user-clock fa-2x text-red-400"></i>
                                <div>
                                    <p class="text-red-400">និស្សិតគ្មានរូបភាព</p>
                                    <p id="list-pending-count" class="text-2xl font-bold text-red-400">-</p>
                                </div>
                            </div>
                        </div>
                        <div id="list-container" class="table-container flex-1 overflow-x-auto">
                            <div id="list-loading" class="text-center py-10">
                                <p class="text-slate-400">កំពុងទាញទិន្នន័យរូបភាពនិស្សិត...</p>
                            </div>
                            <table id="list-table" class="hidden w-full text-left text-slate-300">
                                <thead class="bg-slate-700/50 sticky top-0">
                                    <tr>
                                        <th class="p-3">ID</th>
                                        <th class="p-3">ឈ្មោះ</th>
                                        <th class="p-3">រូបភាព</th>
                                        <th class="p-3 text-center">Status</th>
                                        <th class="p-3 text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- PAGE: RECORDS -->
                    <div id="page-records" class="hidden main-content rounded-2xl p-6 h-full flex flex-col">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                            <h1 class="text-2xl text-white khmer-title">រូបភាពបានរក្សាទុក</h1>
                            <div class="flex gap-4 w-full md:w-auto">
                                <input type="text" id="records-search-input" placeholder="Search ID or Name..." class="w-full bg-slate-700 border-slate-600 rounded-lg px-4 py-2" />
                                <select id="records-class-filter" class="filter-select w-full md:w-auto"></select>
                                <button id="export-records-btn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-download mr-2"></i> Export
                                </button>
                            </div>
                        </div>
                        <div id="records-container" class="table-container flex-1 overflow-x-auto">
                            <div id="records-loading" class="text-center py-10">
                                <p class="text-slate-400">កំពុងទាញរូបភាពបានរក្សាទុក...</p>
                            </div>
                            <table id="records-table" class="hidden w-full text-left text-slate-300">
                                <thead class="bg-slate-700/50 sticky top-0">
                                    <tr>
                                        <th class="p-3">ល.រ</th>
                                        <th class="p-3">ឈ្មោះ</th>
                                        <th class="p-3">ID</th>
                                        <th class="p-3">ថ្នាក់</th>
                                        <th class="p-3">ក្រុម</th>
                                        <th class="p-3">រូបភាព</th>
                                        <th class="p-3 text-center">កែ</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- PAGE: STORAGE -->
                    <div id="page-storage" class="hidden main-content rounded-2xl p-6 h-full flex flex-col">
                        <h1 class="text-2xl text-white khmer-title mb-6">Storage & Links</h1>
                        <p class="text-slate-400 mb-6">This section provides direct links to the Google Sheets and Folders used by the application.</p>
                        <div id="storage-links-container" class="space-y-6"></div>
                    </div>

                    <!-- PAGE: PROFILE -->
                    <div id="page-profile" class="hidden main-content rounded-2xl p-6 h-full flex flex-col">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <img id="profile-img-large" src="" class="w-20 h-20 rounded-full object-cover border-2 border-slate-700" alt="admin" />
                                <div>
                                    <h2 id="profile-name-large" class="text-2xl font-bold">Admin Name</h2>
                                    <div id="profile-role-large" class="text-sm text-slate-400">Role</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-slate-400 text-sm">Total images (all): <span id="profile-total-all">-</span></div>
                                <div class="text-slate-400 text-sm">My uploads: <span id="profile-total-my">-</span></div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <input id="profile-image-filter" type="text" placeholder="Filter images (name / id)" class="w-full bg-slate-700 border-slate-600 rounded-lg px-4 py-2" />
                        </div>

                        <div id="profile-images-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                    </div>
                    
                    <!-- PAGE: ADMIN -->
                    <div id="page-admin" class="hidden main-content rounded-2xl p-6 h-full flex flex-col">
                        <h1 class="text-2xl text-white khmer-title mb-6">Admin Panel (Superadmin)</h1>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Column 1: Settings -->
                            <div class="space-y-4">
                                <h3 class="text-xl font-semibold text-indigo-300">Appearance</h3>
                                <div class="flex items-center justify-between p-3 bg-slate-800/40 rounded-lg">
                                    <div class="text-sm">Theme</div>
                                    <div class="flex items-center gap-2">
                                        <button id="btn-theme-toggle" class="px-3 py-1 rounded bg-slate-700/40">Dark</button>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-3 bg-slate-800/40 rounded-lg">
                                    <div class="text-sm">Language</div>
                                    <div class="flex items-center gap-2">
                                        <button id="btn-lang" class="px-3 py-1 rounded bg-slate-700/40">KH</button>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-3 bg-slate-800/40 rounded-lg">
                                    <div class="text-sm">Background color</div>
                                    <input id="bg-color-picker" type="color" value="#0f172a" class="w-10 h-8 p-0 border-0 rounded" />
                                </div>

                                <h3 class="text-xl font-semibold text-indigo-300 mt-6">My Access</h3>
                                <div id="face-scan-toggle-row" class="hidden flex items-center justify-between p-3 bg-slate-800/40 rounded-lg">
                                    <div class="text-sm">Allow face-scan (for my account)</div>
                                    <input type="checkbox" id="face-scan-enabled" class="w-6 h-6" />
                                </div>
                                
                                <h3 class="text-xl font-semibold text-indigo-300 mt-6">Add New Admin</h3>
                                <div class="p-4 bg-slate-800/40 rounded-lg space-y-3">
                                     <input id="add-admin-name" type="text" placeholder="New Admin Name" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white">
                                     <input id="add-admin-image-url" type="text" placeholder="Image URL" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white">
                                     <input id="add-admin-email" type="text" placeholder="Email (Optional)" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white">
                                     <select id="add-admin-role" class="admin-filter-select w-full">
                                       <option value="viewer">Viewer</option>
                                       <option value="subadmin">Sub-Admin</option>
                                       <option value="admin">Admin</option>
                                       <option value="superadmin">Super-Admin</option>
                                     </select>
                                     <button id="add-admin-btn" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">Add New Admin</button>
                                </div>
                            </div>
                            
                            <!-- Column 2: User Management -->
                            <div class="space-y-4">
                                <h3 class="text-xl font-semibold text-indigo-300">User Management</h3>
                                <div id="admin-management-list" class="space-y-3">
                                    <!-- Admin list will be populated here by JS -->
                                    <div class="text-center text-slate-400 p-4">Loading admin list...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PAGE: ANALYTICS -->
                    <div id="page-analytics" class="hidden main-content rounded-2xl p-6 h-full flex flex-col">
                        <h1 class="text-2xl text-white khmer-title mb-6">Analytics Dashboard</h1>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-slate-400 text-sm">Total Scans Today</span>
                                    <i class="fas fa-camera text-indigo-400"></i>
                                </div>
                                <div id="scans-today" class="text-2xl font-bold text-white">0</div>
                                <div class="text-xs text-green-400 mt-1">
                                    <i class="fas fa-arrow-up"></i> 12% from yesterday
                                </div>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-slate-400 text-sm">Active Users</span>
                                    <i class="fas fa-users text-green-400"></i>
                                </div>
                                <div id="active-users" class="text-2xl font-bold text-white">0</div>
                                <div class="text-xs text-green-400 mt-1">
                                    <i class="fas fa-arrow-up"></i> 5% from last week
                                </div>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-slate-400 text-sm">Completion Rate</span>
                                    <i class="fas fa-chart-pie text-purple-400"></i>
                                </div>
                                <div id="completion-rate" class="text-2xl font-bold text-white">0%</div>
                                <div class="text-xs text-red-400 mt-1">
                                    <i class="fas fa-arrow-down"></i> 3% from last month
                                </div>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-slate-400 text-sm">Storage Used</span>
                                    <i class="fas fa-database text-yellow-400"></i>
                                </div>
                                <div id="storage-used" class="text-2xl font-bold text-white">0 GB</div>
                                <div class="text-xs text-slate-400 mt-1">
                                    60% of total capacity
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold text-white mb-4">Weekly Scanning Activity</h3>
                                <canvas id="weekly-activity-chart" class="w-full h-64"></canvas>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold text-white mb-4">Class Completion Status</h3>
                                <canvas id="class-completion-chart" class="w-full h-64"></canvas>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Add these modals before the closing body tag -->

<!-- First Login Welcome Modal -->
<div id="welcome-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="welcome-modal">
        <div class="welcome-header">
            <img id="welcome-avatar" src="" alt="Admin Avatar" class="welcome-avatar">
            <h2 id="welcome-title" class="welcome-title">Welcome to Face Scan System</h2>
            <p id="welcome-subtitle" class="welcome-subtitle">Let's get you started with a quick tour</p>
        </div>
        <div class="welcome-body">
            <div class="welcome-section">
                <h3 class="welcome-section-title">
                    <i class="fas fa-user-circle"></i>
                    Your Profile
                </h3>
                <div class="welcome-features">
                    <div class="welcome-feature">
                        <div class="welcome-feature-icon">
                            <i class="fas fa-id-badge"></i>
                        </div>
                        <h4 class="welcome-feature-title">Name</h4>
                        <p id="welcome-name" class="welcome-feature-description">Admin Name</p>
                    </div>
                    <div class="welcome-feature">
                        <div class="welcome-feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h4 class="welcome-feature-title">Role</h4>
                        <p id="welcome-role" class="welcome-feature-description">Admin Role</p>
                    </div>
                </div>
            </div>
            
            <div class="welcome-section">
                <h3 class="welcome-section-title">
                    <i class="fas fa-rocket"></i>
                    Key Features
                </h3>
                <div class="welcome-features">
                    <div class="welcome-feature">
                        <div class="welcome-feature-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <h4 class="welcome-feature-title">Face Scanning</h4>
                        <p class="welcome-feature-description">Capture student photos with automatic face detection</p>
                    </div>
                    <div class="welcome-feature">
                        <div class="welcome-feature-icon">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <h4 class="welcome-feature-title">QR Code Scanning</h4>
                        <p class="welcome-feature-description">Quickly identify students using QR codes</p>
                    </div>
                    <div class="welcome-feature">
                        <div class="welcome-feature-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <h4 class="welcome-feature-title">Batch Scanning</h4>
                        <p class="welcome-feature-description">Process multiple students in one session</p>
                    </div>
                    <div class="welcome-feature">
                        <div class="welcome-feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h4 class="welcome-feature-title">Analytics</h4>
                        <p class="welcome-feature-description">View statistics and progress reports</p>
                    </div>
                </div>
            </div>
            
            <div class="welcome-section">
                <h3 class="welcome-section-title">
                    <i class="fas fa-question-circle"></i>
                    Getting Started
                </h3>
                <div class="onboarding-container">
                    <div class="onboarding-step">
                        <div class="onboarding-step-number">1</div>
                        <div class="onboarding-step-content">
                            <h4 class="onboarding-step-title">Select a Student</h4>
                            <p class="onboarding-step-description">Choose a student from the list or search by name/ID</p>
                        </div>
                    </div>
                    <div class="onboarding-step">
                        <div class="onboarding-step-number">2</div>
                        <div class="onboarding-step-content">
                            <h4 class="onboarding-step-title">Capture Photo</h4>
                            <p class="onboarding-step-description">Use automatic face detection or manual capture</p>
                        </div>
                    </div>
                    <div class="onboarding-step">
                        <div class="onboarding-step-number">3</div>
                        <div class="onboarding-step-content">
                            <h4 class="onboarding-step-title">Upload & Save</h4>
                            <p class="onboarding-step-description">Confirm and upload the photo to the system</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="welcome-actions">
                <button id="start-tour-btn" class="welcome-btn welcome-btn-primary">
                    <i class="fas fa-play"></i>
                    Start Interactive Tour
                </button>
                <button id="skip-tour-btn" class="welcome-btn welcome-btn-secondary">
                    <i class="fas fa-forward"></i>
                    Skip Tour
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Role Info Modal -->
<div id="role-info-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="role-info-modal">
        <div class="role-info-header">
            <div class="role-badge">
                <i class="fas fa-shield-alt"></i>
                <span id="role-badge-text">Admin Role</span>
            </div>
            <h2 id="role-title" class="role-title">Your Role & Permissions</h2>
            <p id="role-description" class="role-description">Here's what you can do in the system</p>
        </div>
        <div class="role-info-body">
            <div class="role-permissions">
                <h3 class="role-permissions-title">Your Permissions</h3>
                <ul id="permission-list" class="permission-list">
                    <!-- Permissions will be populated by JavaScript -->
                </ul>
            </div>
            
            <div class="role-actions">
                <button id="view-dashboard-btn" class="role-btn role-btn-primary">
                    <i class="fas fa-tachometer-alt"></i>
                    Go to Dashboard
                </button>
                <button id="close-role-btn" class="role-btn role-btn-secondary">
                    <i class="fas fa-times"></i>
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- QR Scanner Modal -->
<div id="qr-scanner-modal">
    <div class="modal-header">
        <h3 class="modal-title">QR Code Scanner</h3>
        <button class="close-btn" id="close-qr-scanner">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="scan-region">
        <video id="qr-video"></video>
    </div>
    <div class="instructions">
        <p>Position the QR code within the frame to scan</p>
        <p>The scanner will automatically detect and process the QR code</p>
    </div>
</div>

<!-- Batch Scan Modal -->
<div id="batch-scan-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Batch Scanning</h3>
            <button class="close-btn" id="close-batch-scan">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="instructions">
            <p>Select students without photos to scan in batch mode</p>
        </div>
        <div class="batch-list" id="batch-list">
            <!-- Batch list will be populated by JavaScript -->
        </div>
        <div class="modal-footer">
            <div class="selected-count">
                <span id="selected-count">0</span> students selected
            </div>
            <div class="actions">
                <button class="btn btn-cancel" id="cancel-batch-scan">Cancel</button>
                <button class="btn btn-start" id="start-batch-scan" disabled>Start Batch Scan</button>
            </div>
        </div>
    </div>
</div>

<!-- Tour Guide -->
<div id="tour-guide" class="tour-guide hidden">
    <div class="tour-guide-arrow"></div>
    <h3 class="tour-guide-title" id="tour-title">Tour Title</h3>
    <p class="tour-guide-content" id="tour-content">Tour content goes here</p>
    <div class="tour-guide-actions">
        <button class="tour-guide-skip" id="tour-skip">Skip Tour</button>
        <button class="tour-guide-next" id="tour-next">Next</button>
    </div>
</div>

    <!-- MODAL -->
    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal">
        <div class="modal-content w-full max-w-sm p-6 rounded-2xl shadow-2xl text-center">
            <div id="modal-icon" class="w-16 h-16 mx-auto mb-4"></div>
            <p id="modal-message" class="text-lg font-semibold text-white mb-6"></p>
            <div id="modal-buttons" class="flex flex-col sm:flex-row gap-4"></div>
        </div>
    </div>

    <!-- NOTIFICATION TOAST -->
    <div id="notification-toast" class="fixed bottom-4 right-4 transform translate-x-full transition-transform duration-300 z-50">
        <div class="bg-slate-800 text-white p-4 rounded-lg shadow-lg flex items-center gap-3 min-w-[300px]">
            <div id="notification-icon" class="flex-shrink-0"></div>
            <div>
                <p id="notification-title" class="font-semibold"></p>
                <p id="notification-message" class="text-sm text-slate-300"></p>
            </div>
            <button id="notification-close" class="ml-auto text-slate-400 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>